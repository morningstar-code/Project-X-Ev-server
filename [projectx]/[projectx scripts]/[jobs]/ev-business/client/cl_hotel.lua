CASINO_HOTEL_CONFIG = { -- TODO: Add business here (casino_hotel)?
    {
        coords = vector4(924.84, -57.53, 21.0, 151.03),
        setName = "set_hotel_room_small_01",
        size = "small"
    }, {
        coords = vector4(927.59, -53.05, 21.0, 153.8),
        setName = "set_hotel_room_small_02",
        size = "medium"
    }, {
        coords = vector4(934.69, -47.76, 21.0, 242.64),
        setName = "set_hotel_room_large_01",
        size = "large"
    }, {
        coords = vector4(929.74, -33.3, 21.0, 240.13),
        setName = "set_hotel_room_small_03",
        size = "small"
    }, {
        coords = vector4(925.38, -30.54, 21.0, 241.65),
        setName = "set_hotel_room_small_01",
        size = "medium"
    }, {
        coords = vector4(919.9, -23.65, 21.0, 331.64),
        setName = "set_hotel_room_large_02",
        size = "large"
    }, {
        coords = vector4(905.55, -28.49, 21.0, 334.11),
        setName = "set_hotel_room_small_02",
        size = "small"
    }, {
        coords = vector4(902.78, -33.08, 21.0, 328.6),
        setName = "set_hotel_room_small_03",
        size = "medium"
    }, {
        coords = vector4(895.92, -38.18, 21.0, 62.7),
        setName = "set_hotel_room_large_03",
        size = "large"
    }, {
        coords = vector4(878.43, -42.71, 21.0, 328.77),
        setName = "set_hotel_room_small_01",
        size = "small"
    }, {
        coords = vector4(875.61, -46.97, 21.0, 329.12),
        setName = "set_hotel_room_small_02",
        size = "medium"
    }, {
        coords = vector4(872.8, -51.54, 21.0, 332.0),
        setName = "set_hotel_room_small_03",
        size = "small"
    }, {
        coords = vector4(870.2, -55.86, 21.0, 333.1),
        setName = "set_hotel_room_small_01",
        size = "medium"
    }, {
        coords = vector4(863.32, -61.08, 21.0, 60.03),
        setName = "set_hotel_room_large_01",
        size = "large"
    }, {
        coords = vector4(868.2, -75.64, 21.0, 60.99),
        setName = "set_hotel_room_small_01",
        size = "small"
    }, {
        coords = vector4(872.76, -78.5, 21.0, 59.54),
        setName = "set_hotel_room_small_03",
        size = "medium"
    }, {
        coords = vector4(877.17, -81.06, 21.0, 64.89),
        setName = "set_hotel_room_small_01",
        size = "small"
    }, {
        coords = vector4(881.51, -83.9, 21.0, 64.56),
        setName = "set_hotel_room_small_02",
        size = "medium"
    }, {
        coords = vector4(885.86, -86.55, 21.0, 63.23),
        setName = "set_hotel_room_small_03",
        size = "small"
    }, {
        coords = vector4(891.04, -93.49, 21.0, 151.99),
        setName = "set_hotel_room_large_02",
        size = "large"
    }, {
        coords = vector4(905.59, -88.52, 21.0, 163.76),
        setName = "set_hotel_room_small_01",
        size = "medium"
    }, {
        coords = vector4(908.44, -84.1, 21.0, 153.46),
        setName = "set_hotel_room_small_02",
        size = "small"
    }, {
        coords = vector4(911.1, -79.61, 21.0, 159.36),
        setName = "set_hotel_room_small_03",
        size = "medium"
    }, {
        coords = vector4(918.13, -74.63, 21.0, 237.14),
        setName = "set_hotel_room_large_03",
        size = "large"
    }
}

local spawnLocations = {
    {
        id = "rr_1",
        position = {x = -135.91, y = 312.43, z = 98.47, h = 0},
        name = "Roosters Rest Room 1",
        biz = "rr_hotel"
    }, {
        id = "rr_2",
        position = {x = -149.0, y = 312.66, z = 98.47, h = 0},
        name = "Roosters Rest Room 2",
        biz = "rr_hotel"
    }, {
        id = "rr_3",
        position = {x = -136.1, y = 318.01, z = 98.47, h = 0},
        name = "Roosters Rest Room 3",
        biz = "rr_hotel"
    }, {
        id = "rr_4",
        position = {x = -149.0, y = 318.47, z = 98.47, h = 0},
        name = "Roosters Rest Room 4",
        biz = "rr_hotel"
    }, {
        id = "rr_5",
        position = {x = -136.1, y = 324.16, z = 98.47, h = 0},
        name = "Roosters Rest Room 5",
        biz = "rr_hotel"
    }, {
        id = "rr_6",
        position = {x = -148.99, y = 324.14, z = 98.47, h = 0},
        name = "Roosters Rest Room 6",
        biz = "rr_hotel"
    }, {
        id = "rr_7",
        position = {x = -136.06, y = 329.82, z = 98.47, h = 0},
        name = "Roosters Rest Room 7",
        biz = "rr_hotel"
    }, {
        id = "rr_8",
        position = {x = -148.92, y = 329.79, z = 98.47, h = 0},
        name = "Roosters Rest Room 8",
        biz = "rr_hotel"
    }, {
        id = "rr_9",
        position = {x = -135.65, y = 336.46, z = 98.47, h = 0},
        name = "Roosters Rest Room 9",
        biz = "rr_hotel"
    }, {
        id = "rr_10",
        position = {x = -149.42, y = 336.46, z = 98.47, h = 0},
        name = "Roosters Rest Room 10",
        biz = "rr_hotel"
    }
    -- don't add to this list manually, do it below the thread below adding the config
    -- { id = "cas_1",  position = { x = 922.19, y = -54.26, z = 21.0, h = 0 },   name = "Casino Room 501",       biz = "casino_hotel" },
    -- { id = "cas_2",  position = { x = 924.78, y = -49.77, z = 21.0, h = 0 },   name = "Casino Room 502",       biz = "casino_hotel" },
    -- { id = "cas_3",  position = { x = 927.65, y = -45.49, z = 21.0, h = 0 },   name = "Casino Room 503",       biz = "casino_hotel" },
    -- { id = "cas_4",  position = { x = 926.56, y = -35.78, z = 21.0, h = 0 },   name = "Casino Room 504",       biz = "casino_hotel" },
    -- { id = "cas_5",  position = { x = 922.1, y = -33.25, z = 21.0, h = 0 },    name = "Casino Room 505",       biz = "casino_hotel" },
    -- { id = "cas_6",  position = { x = 917.8, y = -30.2, z = 21.0, h = 0 },     name = "Casino Room 506",       biz = "casino_hotel" },
    -- { id = "cas_7",  position = { x = 908.21, y = -31.65, z = 21.0, h = 0 },   name = "Casino Room 507",       biz = "casino_hotel" },
    -- { id = "cas_8",  position = { x = 905.34, y = -36.05, z = 21.0, h = 0 },   name = "Casino Room 508",       biz = "casino_hotel" },
    -- { id = "cas_9",  position = { x = 902.54, y = -40.41, z = 21.0, h = 0 },   name = "Casino Room 509",       biz = "casino_hotel" },
    -- { id = "cas_10", position = { x = 880.99, y = -45.54, z = 21.0, h = 0 },   name = "Casino Room 510",       biz = "casino_hotel" },
    -- { id = "cas_11", position = { x = 878.26, y = -50.07, z = 21.0, h = 0 },   name = "Casino Room 511",       biz = "casino_hotel" },
    -- { id = "cas_12", position = { x = 875.21, y = -54.57, z = 21.0, h = 0 },   name = "Casino Room 512",       biz = "casino_hotel" },
    -- { id = "cas_13", position = { x = 872.59, y = -59.06, z = 21.0, h = 0 },   name = "Casino Room 513",       biz = "casino_hotel" },
    -- { id = "cas_14", position = { x = 870.03, y = -63.16, z = 21.0, h = 0 },   name = "Casino Room 514",       biz = "casino_hotel" },
    -- { id = "cas_15", position = { x = 871.02, y = -72.97, z = 21.0, h = 0 },   name = "Casino Room 515",       biz = "casino_hotel" },
    -- { id = "cas_16", position = { x = 875.82, y = -75.95, z = 21.0, h = 0 },   name = "Casino Room 516",       biz = "casino_hotel" },
    -- { id = "cas_17", position = { x = 880.26, y = -78.73, z = 21.0, h = 0 },   name = "Casino Room 517",       biz = "casino_hotel" },
    -- { id = "cas_18", position = { x = 884.62, y = -81.41, z = 21.0, h = 0 },   name = "Casino Room 518",       biz = "casino_hotel" },
    -- { id = "cas_19", position = { x = 888.94, y = -84.09, z = 21.0, h = 0 },   name = "Casino Room 519",       biz = "casino_hotel" },
    -- { id = "cas_20", position = { x = 893.21, y = -86.8, z = 21.0, h = 0 },    name = "Casino Room 520",       biz = "casino_hotel" },
    -- { id = "cas_21", position = { x = 902.98, y = -85.68, z = 21.0, h = 0 },   name = "Casino Room 521",       biz = "casino_hotel" },
    -- { id = "cas_22", position = { x = 905.96, y = -80.95, z = 21.0, h = 0 },   name = "Casino Room 522",       biz = "casino_hotel" },
    -- { id = "cas_23", position = { x = 908.7, y = -76.54, z = 21.0, h = 0 },    name = "Casino Room 523",       biz = "casino_hotel" },
    -- { id = "cas_24", position = { x = 911.32, y = -72.32, z = 21.0, h = 0 },   name = "Casino Room 524",       biz = "casino_hotel" },
    -- don't add to this list manually, do it below the thread below adding the config
}

local retreatRooms = {
    {
        id = "retreat_1",
        position = vector3(-1058.82, 4915.42, 211.82),
        name = "Retreat Room 1",
        biz = "roosterretreat"
    }, {
        id = "retreat_2",
        position = vector3(-1075.31, 4897.47, 214.28),
        name = "Retreat Room 2",
        biz = "roosterretreat"
    }, {
        id = "retreat_3",
        position = vector3(-1098.54, 4893.35, 216.08),
        name = "Retreat Room 3",
        biz = "roosterretreat"
    }, {
        id = "retreat_4",
        position = vector3(-1113.35, 4903.43, 218.6),
        name = "Retreat Room 4",
        biz = "roosterretreat"
    }, {
        id = "retreat_5",
        position = vector3(-1101.4, 4941.17, 218.36),
        name = "Retreat Room 5",
        biz = "roosterretreat"
    }, {
        id = "retreat_6",
        position = vector3(-1134.68, 4948.9, 222.27),
        name = "Retreat Room 6",
        biz = "roosterretreat"
    }, {
        id = "retreat_7",
        position = vector3(-1144.08, 4908.48, 220.97),
        name = "Retreat Room 7",
        biz = "roosterretreat"
    }
}

Citizen.CreateThread(function()
    local function pad(k)
        if k < 10 then return "0" .. tostring(k) end
        return tostring(k)
    end
    for k, v in pairs(CASINO_HOTEL_CONFIG) do
        local v3 = vector3(v.coords.x, v.coords.y, v.coords.z)
        spawnLocations[#spawnLocations + 1] = {
            ["id"] = "cas_" .. tostring(k),
            ["position"] = {
                x = v.coords.x,
                y = v.coords.y,
                z = v.coords.z,
                h = 0
            },
            ["name"] = "Casino Room 5" .. pad(k),
            ["biz"] = "casino_hotel"
        }
        TriggerEvent("ev-apartments:addOutfitSpot", v3)

        local interiorSetNames = nil
        if v.size == "large" then
            interiorSetNames = {
                ["set_hotel_room_large_01"] = false,
                ["set_hotel_room_large_02"] = false,
                ["set_hotel_room_large_03"] = false
            }
        else
            interiorSetNames = {
                ["set_hotel_room_small_01"] = false,
                ["set_hotel_room_small_02"] = false,
                ["set_hotel_room_small_03"] = false
            }
        end

        local cInteriorId = GetInteriorAtCoords(v3)
        for k, _ in pairs(interiorSetNames) do
            DeactivateInteriorEntitySet(cInteriorId, k)
        end
        if v.extraSets then
            for _, extraSet in pairs(v.extraSets) do
                print(cInteriorId, extraSet)
                ActivateInteriorEntitySet(cInteriorId, extraSet)
            end
        end
        ActivateInteriorEntitySet(cInteriorId, v.setName)
        RefreshInterior(cInteriorId)
    end

    for k, v in pairs(retreatRooms) do
        spawnLocations[#spawnLocations + 1] = {
            ["id"] = "rretreat_" .. tostring(k),
            ["position"] = {
                x = v.position.x,
                y = v.position.y,
                z = v.position.z,
                h = 0
            },
            ["name"] = v.name,
            ["biz"] = v.biz
        }
        TriggerEvent("ev-apartments:addOutfitSpot", position)
    end
end)

function ensurePermission(business)
    local hasPermission = HasPermission(business, "craft_access")
    if not hasPermission then
        TriggerEvent("DoLongHudText", "You do not have permission for this.", 2)
        return false
    end
    return true
end

function getHotelRoomsListOptions(biz)
    local rooms = getHotelRooms(biz)
    local options = {}
    for k, v in ipairs(rooms) do
        options[#options + 1] = {id = v.id, name = v.name}
    end
    return options
end

function getHotelRooms(biz)
    local rooms = {};
    for k, v in ipairs(spawnLocations) do
        if v.biz == biz then
            rooms[#rooms + 1] = v
        end
    end
    return rooms
end

function getHotelRoomSpawn(roomId)
    for k, v in pairs(spawnLocations) do
        if v.id == roomId then
            return v
        end
    end
end

function getRoomsForCid(cid)
    local roomIds = RPC.execute("pjx-business:hotel:rpc:getRooms", cid)
    local rooms = {};
    for k, v in pairs(roomIds) do
        rooms[#rooms + 1] = getHotelRoomSpawn(v)
    end
    return rooms
end

-- List tenants

AddEventHandler("ev-business:hotel:listTenantsPrompt", function(args)
    local biz = args.biz
    if not ensurePermission(biz) then return end
    exports["ev-ui"]:openApplication("textbox", {
        callbackUrl = "ev-business:hotel:ui:listTenants",
        inputKey = "ev-business:hotel:ui:listTenants",
        items = {
            {
                _type = "select",
                options = getHotelRoomsListOptions(biz),
                icon = "user-edit",
                label = "Room",
                name = "room"
            }
        },
        show = true
    })
end)

RegisterUICallback("ev-business:hotel:ui:listTenants", function(data, cb)
    cb({data = {}, meta = {ok = true, message = ""}})
    exports["ev-ui"]:closeApplication("textbox")
    local tenants = RPC.execute("ev-business:hotel:rpc:getTenants", data.values.room)
    if #tenants == 0 then
        TriggerEvent("chatMessage", "Tenants", {30, 144, 255}, "This room has no tenants", "feed", false)
    else
        TriggerEvent("chatMessage", "Tenants", {30, 144, 255}, table.concat(tenants, ", "))
    end
end)

-- Add tenants

AddEventHandler("ev-business:hotel:addTenantPrompt", function(args)
    local biz = args.biz
    if not ensurePermission(biz) then return end
    exports["ev-ui"]:openApplication("textbox", {
        callbackUrl = "ev-business:hotel:ui:addTenant",
        inputKey = "ev-business:hotel:ui:addTenant",
        items = {
            {
                _type = "select",
                options = getHotelRoomsListOptions(biz),
                icon = "user-edit",
                label = "Room",
                name = "room"
            }, {icon = "user-edit", label = "Citizen ID", name = "cid"}, {
                icon = "user-check",
                label = "Main tenant?",
                name = "main",
                _type = "checkbox"
            }
        },
        show = true
    });
end)

RegisterUICallback("ev-business:hotel:ui:addTenant", function(data, cb)
    cb({data = {}, meta = {ok = true, message = ""}})
    exports["ev-ui"]:closeApplication("textbox")
    local success = RPC.execute("ev-business:hotel:rpc:addTenant", data.values.room, data.values.cid, data.values.main)
    if success then
        TriggerEvent("DoLongHudText", "Successfully added tenant.", 1)
    else
        TriggerEvent("DoLongHudText", "Unable to add tenant.", 2)
    end
end)

RegisterUICallback("ev-business:hotel:ui:getRooms", function(data, cb)
    -- local rooms = getRoomsForCid(data.cid)
    cb({data = {}, meta = {ok = true, message = ""}})
end)

-- Remove tenant

AddEventHandler("ev-business:hotel:removeTenantPrompt", function(args)
    local biz = args.biz
    if not ensurePermission(biz) then return end
    exports["ev-ui"]:openApplication("textbox", {
        callbackUrl = "ev-business:hotel:ui:removeTenant",
        inputKey = "ev-business:hotel:ui:removeTenant",
        items = {
            {
                _type = "select",
                options = getHotelRoomsListOptions(biz),
                icon = "user-edit",
                label = "Room",
                name = "room"
            }, {icon = "user-edit", label = "Citizen ID", name = "cid"}
        },
        show = true
    });
end)

RegisterUICallback("ev-business:hotel:ui:removeTenant", function(data, cb)
    cb({data = {}, meta = {ok = true, message = ""}})
    exports["ev-ui"]:closeApplication("textbox")
    local success = RPC.execute("ev-business:hotel:rpc:removeTenant", data.values.room, data.values.cid)
    if success then
        TriggerEvent("DoLongHudText", "Successfully removed tenant.", 1)
    else
        TriggerEvent("DoLongHudText", "Unable to remove tenant.", 2)
    end
end)

-- Clear tenants

AddEventHandler("ev-business:hotel:clearTenantsPrompt", function(args)
    local biz = args.biz
    if not ensurePermission(biz) then return end
    exports["ev-ui"]:openApplication("textbox", {
        callbackUrl = "ev-business:hotel:ui:clearTenants",
        inputKey = "ev-business:hotel:ui:clearTenants",
        items = {
            {
                _type = "select",
                options = getHotelRoomsListOptions(biz),
                icon = "user-edit",
                label = "Room",
                name = "room"
            }
        },
        show = true
    });
end)

RegisterUICallback("ev-business:hotel:ui:clearTenants", function(data, cb)
    cb({data = {}, meta = {ok = true, message = ""}})
    exports["ev-ui"]:closeApplication("textbox")
    RPC.execute("ev-business:hotel:rpc:clearTenants", data.values.room)
    TriggerEvent("DoLongHudText", "Tenants cleared.", 1)
end)

exports("getHotelRoomSpawn", getHotelRoomSpawn)
exports("getCasinoHotelConfig", function()
    local temp = {}

    for k, v in pairs(CASINO_HOTEL_CONFIG) do
        temp[#temp + 1] = {
            coords = {x = v.coords.x, y = v.coords.y, z = v.coords.z},
            size = v.size,
            heading = v.coords.w
        }
    end

    return temp
end)